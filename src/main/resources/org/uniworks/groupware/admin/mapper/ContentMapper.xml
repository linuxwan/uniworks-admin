<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="org.uniworks.groupware.admin.mapper.ContentMapper"> 
	<resultMap id="BaseResultMap" type="org.uniworks.groupware.admin.domain.ContentInfo"> 
		<result column="CO_ID" jdbcType="VARCHAR" property="coId" />
		<result column="CNTN_ID" jdbcType="VARCHAR" property="cntnId" /> 
		<result column="CNTN_NAME" jdbcType="VARCHAR" property="cntnName" />
		<result column="CNTN_OFFER_TYPE" jdbcType="VARCHAR" property="cntnOfferType" /> 
		<result column="CNTN_OFFER_TYPE_DESC" jdbcType="VARCHAR" property="cntnOfferTypeDesc" />
		<result column="LINK_SYS_HOST" jdbcType="VARCHAR" property="linkSysHost" /> 
		<result column="URL" jdbcType="VARCHAR" property="url" /> 
		<result column="CNTN_TYPE" jdbcType="VARCHAR" property="cntnType" /> 
		<result column="CNTN_TYPE_DESC" jdbcType="VARCHAR" property="cntnTypeDesc" />
		<result column="MASTER_ID" jdbcType="VARCHAR" property="masterId" /> 
		<result column="CNTN_JOINT_FLAG" jdbcType="VARCHAR" property="cntnJointFlag" /> 
		<result column="CNTN_DESC" jdbcType="VARCHAR" property="cntnDesc" /> 
		<result column="CNTN_RGSR_DATE" jdbcType="TIMESTAMP" property="cntnRgsrDate" /> 
		<result column="CNTN_RGSR_ID" jdbcType="VARCHAR" property="cntnRgsrId" /> 
		<result column="CNTN_CHNG_DATE" jdbcType="TIMESTAMP" property="cntnChngDate" /> 
		<result column="CNTN_CHNG_ID" jdbcType="VARCHAR" property="cntnChngId" /> 
		<result column="PORT_NO" jdbcType="INTEGER" property="portNo" /> 
	</resultMap> 	
	
	<!-- 목록 조회 --> 
	<select id="selectContentList" parameterType="java.util.Map" resultMap="BaseResultMap"> 
		select c.CO_ID, a.CNTN_ID, b.CNTN_NAME, a.CNTN_OFFER_TYPE, e.RESC_KEY_VALUE CNTN_OFFER_TYPE_DESC, a.LINK_SYS_HOST, a.URL, 
		       a.CNTN_TYPE, g.RESC_KEY_VALUE CNTN_TYPE_DESC, a.MASTER_ID, 
		       a.CNTN_JOINT_FLAG, a.CNTN_DESC, a.CNTN_RGSR_DATE, a.CNTN_RGSR_ID, a.CNTN_CHNG_DATE, a.CNTN_CHNG_ID, a.PORT_NO
		  from gw.nw030m a
		  left join gw.nw031m b 
			on a.CNTN_ID = b.CNTN_ID
		   and b.LOCALE = #{lang,jdbcType=VARCHAR} 
		  left join gw.nw032m c
		    on a.CNTN_ID = c.CNTN_ID
		   and c.CO_ID = #{coId,jdbcType=VARCHAR}
		   and SYSDATE() between c.ST_DATE and c.FIN_DATE
		  left join gw.cm002c d
			on d.CO_ID = c.CO_ID
		   and d.MAJ_CODE = 'CD009'
		   and d.SUB_CODE = a.CNTN_OFFER_TYPE
		  left join gw.cm003m e
		    on e.CO_ID = c.CO_ID
		   and e.RESC_KEY = d.RESC_KEY
		   and e.LOCALE = b.LOCALE
		  left join gw.cm002c f
		    on f.CO_ID = c.CO_ID
		   and f.MAJ_CODE = 'CD011'
		   and f.SUB_CODE = a.CNTN_TYPE
		  left join gw.cm003m g
		    on g.CO_ID = c.CO_ID
		   and g.RESC_KEY = f.RESC_KEY
		   and g.LOCALE = b.LOCALE
		where C.CO_ID = #{coId,jdbcType=VARCHAR}
		<if test="searchKind == 'cntnName'">
	      and	B.CNTN_NAME like #{searchWord,jdbcType=VARCHAR}
	    </if>
	    <if test="searchKind == 'cntnId'">
	      and	A.CNTN_ID like #{searchWord,jdbcType=VARCHAR}
	    </if>	    
	    <if test="orderBy == 'cntnId'">
		order by A.CNTN_ID  
		</if>
		<if test="orderBy == 'cntnName'">
		order by B.CNTN_NAME
		</if>  	
	</select> 
	
 	<!-- 컨텐츠 조회 -->
 	<select id="selectContentInfo" parameterType="java.util.Map" resultMap="BaseResultMap"> 
		select c.CO_ID, a.CNTN_ID, b.CNTN_NAME, a.CNTN_OFFER_TYPE, e.RESC_KEY_VALUE CNTN_OFFER_TYPE_DESC, a.LINK_SYS_HOST, a.URL, 
		       a.CNTN_TYPE, g.RESC_KEY_VALUE CNTN_TYPE_DESC, a.MASTER_ID, 
		       a.CNTN_JOINT_FLAG, a.CNTN_DESC, a.CNTN_RGSR_DATE, a.CNTN_RGSR_ID, a.CNTN_CHNG_DATE, a.CNTN_CHNG_ID, a.PORT_NO
		  from gw.nw030m a
		  left join gw.nw031m b 
			on a.CNTN_ID = b.CNTN_ID
		   and b.LOCALE = #{lang,jdbcType=VARCHAR} 
		  left join gw.nw032m c
		    on a.CNTN_ID = c.CNTN_ID
		   and c.CO_ID = #{coId,jdbcType=VARCHAR}
		   and SYSDATE() between c.ST_DATE and c.FIN_DATE
		  left join gw.cm002c d
			on d.CO_ID = c.CO_ID
		   and d.MAJ_CODE = 'CD009'
		   and d.SUB_CODE = a.CNTN_OFFER_TYPE
		  left join gw.cm003m e
		    on e.CO_ID = c.CO_ID
		   and e.RESC_KEY = d.RESC_KEY
		   and e.LOCALE = b.LOCALE
		  left join gw.cm002c f
		    on f.CO_ID = c.CO_ID
		   and f.MAJ_CODE = 'CD011'
		   and f.SUB_CODE = a.CNTN_TYPE
		  left join gw.cm003m g
		    on g.CO_ID = c.CO_ID
		   and g.RESC_KEY = f.RESC_KEY
		   and g.LOCALE = b.LOCALE
		where C.CO_ID = #{coId,jdbcType=VARCHAR}
		  and A.CNTN_ID = #{cntnId,jdbcType=VARCHAR}
	</select> 
	
	<!-- 컨텐츠 사용유무 업데이트 -->
	<update id="updateUseIndc" parameterType="java.util.Map"> 
		update	nw032m 
		set USE_INDC= 'N'  		
		where	CNTN_ID	=	#{cntnId,jdbcType=VARCHAR} 
		  and	CO_ID	NOT IN
		  	<foreach collection="coId" item="type" open="(" close=")"	separator=",">
		  		#{type}
		  	</foreach>		  		 
	</update> 
</mapper>